<html lang="en">
<head>
  <title>Red Global</title>
  <script type="text/javascript" charset="utf-8">
    
  // Set up the Listener  
  safari.application.addEventListener("command", performCommand, false); 
  safari.application.addEventListener("message", respondToMessage, false);
  
  var isConnected = false;
  
  var socket = new WebSocket("wss://localhost:49803/service");
  socket.onopen = function(){
    
    console.log('open');
  
    isConnected=true;
  }
  
  
    
  function performCommand(event) {  
      // Make sure event comes from the button 
      command = event.command;
      if (command == 'addToRedQueue') {
        if (isConnected) {
          socket.send(event.userInfo);
        
        } else {
          console.log('not connected');
        
        }
      
      } 
      
      
        
  }  
  //respond to middle clicks
  function respondToMessage(messageEvent) {
    if (messageEvent.name === 'addToRedQueue') {
    
      if (isConnected) {
        socket.send(messageEvent.message);
        
      } else {
        console.log('not connected');
        
      }
    }
  
  }
    
  </script>
</head>
</html>