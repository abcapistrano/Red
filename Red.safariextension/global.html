<html lang="en">
<head>
  <title>Red Global</title>
  <script type="text/javascript" charset="utf-8">
    
  // Set up the Listener  
  safari.application.addEventListener("command", performCommand, false); 
  safari.application.addEventListener("message", respondToMessage, false);
 
  var isConnected = false;
  
  var socket = new WebSocket("ws://localhost:49803/service");
  socket.onopen = function(){
    
    console.log('open');
  
    isConnected=true;
  }
    
  function performCommand(event) {  
      // Make sure event comes from the button 
      command = event.command;

      if (!isConnected) {

          console.log('not connected.');
      }

      

      if (command == 'addReadingListItem') {
          console.log('triggered');
          socket.send(event.userInfo);
      }

  }
      
      
        
  
  //respond to middle clicks
  function respondToMessage(messageEvent) {
    if (messageEvent.name === 'addReadingListItem') {
    
      if (isConnected) {
        socket.send(messageEvent.message);

      } else {
        console.log('not connected');
        
      }
    }
  
  }
    
  </script>
</head>
</html>